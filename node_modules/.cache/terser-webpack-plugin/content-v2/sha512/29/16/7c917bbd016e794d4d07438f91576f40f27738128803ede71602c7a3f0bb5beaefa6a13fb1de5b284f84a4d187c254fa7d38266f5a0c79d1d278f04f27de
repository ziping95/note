{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{213:function(t,r,a){t.exports=a.p+\"assets/img/Filter.e2d9cb83.jpg\"},214:function(t,r,a){t.exports=a.p+\"assets/img/internalDoFilter.73119bf2.png\"},215:function(t,r,a){t.exports=a.p+\"assets/img/internalDoFilter-1.f21235ab.png\"},249:function(t,r,a){\"use strict\";a.r(r);var s=a(0),e=Object(s.a)({},(function(){var t=this,r=t.$createElement,s=t._self._c||r;return s(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[s(\"h1\",{attrs:{id:\"监听器、过滤器、拦截器\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#监听器、过滤器、拦截器\"}},[t._v(\"#\")]),t._v(\" 监听器、过滤器、拦截器\")]),t._v(\" \"),s(\"p\",[t._v(\"本章的每一节内容就是自己的理解，会随着经验的增加慢慢修改......\")]),t._v(\" \"),s(\"h2\",{attrs:{id:\"过滤器（filter）\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#过滤器（filter）\"}},[t._v(\"#\")]),t._v(\" 过滤器（Filter）\")]),t._v(\" \"),s(\"p\",[t._v(\"前两天项目中有一个增加监控日志的需求，选择了用过滤器的方式实现，写完后突然想到过滤器链一层一层向下调用，最后是怎么访问资源的呢，\"),s(\"code\",[t._v(\"chain.doFilter(request, response)\")]),t._v(\"这个方法到底做了什么？\\n带着疑问看了下源码，在这里记录下，没全看懂，慢慢来吧\")]),t._v(\" \"),s(\"p\",[t._v(\"先看一下一个请求进到容器后的大概流程，其中过滤器是最先被执行的\\n\"),s(\"img\",{attrs:{src:a(213),alt:\"\"}})]),t._v(\" \"),s(\"div\",{staticClass:\"custom-block tip\"},[s(\"p\",{staticClass:\"custom-block-title\"},[t._v(\"过滤器和拦截器的区别\")]),t._v(\" \"),s(\"p\",[t._v(\"filter先于servlet启动，是随着web容器一起启动的，并且仅初始化一次，当过滤器调用完后，开始执行servlet的service方法，在service方法里会有拦截器的相关的逻辑\\nfilter是依靠函数回调完成的，而interceptor是依靠反射完成的，是面相aop切面编程的概念\")])]),t._v(\" \"),s(\"p\",[t._v(\"在实际写过滤器逻辑的时候，最后一定会写\"),s(\"code\",[t._v(\"chain.doFilter(request, response)\")]),t._v(\"，但\"),s(\"code\",[t._v(\"doFilter\")]),t._v(\"具体做了什么，通过debug发现，该方法传入\"),s(\"code\",[t._v(\"FilterChain\")]),t._v(\"的实现类\"),s(\"code\",[t._v(\"ApplicationFilterChain\")]),t._v(\"，当然不是只有这一个实现类\")]),t._v(\" \"),s(\"p\",[t._v(\"这里只写\"),s(\"code\",[t._v(\"ApplicationFilterChain\")]),t._v(\"，用的最多的也是这个类，这个类在tomcat的包里，这也验证了\"),s(\"code\",[t._v(\"filter\")]),t._v(\"是随着容器启动的，既然实现了这个接口，就一定有\"),s(\"code\",[t._v(\"doFilter\")]),t._v(\"方法\")]),t._v(\" \"),s(\"p\",[t._v(\"在这个方法里看到有一句\"),s(\"code\",[t._v(\"internalDoFilter(request,response)\")]),t._v(\"，点进去看一下\\n\"),s(\"img\",{attrs:{src:a(214),alt:\"\"}}),t._v(\"\\n这里的\"),s(\"code\",[t._v(\"pos\")]),t._v(\"和\"),s(\"code\",[t._v(\"n\")]),t._v(\"分别表示当前的过滤器序号和过滤器链中全部过滤器数量，下面是这个类其中几个属性的解释\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-java extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[t._v(\"    \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"/**\\n     * Filters.\\n     */\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"private\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"ApplicationFilterConfig\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),t._v(\" filters \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"new\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"ApplicationFilterConfig\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"/**\\n     * The int which is used to maintain the current position\\n     * in the filter chain.\\n     */\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"private\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"int\")]),t._v(\" pos \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"/**\\n     * The int which gives the current number of filters in the chain.\\n     */\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"private\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"int\")]),t._v(\" n \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"0\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"/**\\n     * The servlet instance to be executed by this chain.\\n     */\")]),t._v(\"\\n    \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"private\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[t._v(\"Servlet\")]),t._v(\" servlet \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"=\")]),t._v(\" \"),s(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[t._v(\"null\")]),s(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\";\")]),t._v(\"\\n\")])])]),s(\"p\",[t._v(\"如果\"),s(\"code\",[t._v(\"pos < n\")]),t._v(\"为\"),s(\"code\",[t._v(\"false\")]),t._v(\"则进入到下面的流程\")]),t._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:a(215),alt:\"\"}}),t._v(\"\\n这里最后调用了\"),s(\"code\",[t._v(\"servlet\")]),t._v(\"的\"),s(\"code\",[t._v(\"service\")]),t._v(\"方法，这也印证了\"),s(\"code\",[t._v(\"filter\")]),t._v(\"先于\"),s(\"code\",[t._v(\"servlet\")]),t._v(\"执行\")]),t._v(\" \"),s(\"h4\",{attrs:{id:\"多个过滤器之间的调用顺序是怎么指定的呢？\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#多个过滤器之间的调用顺序是怎么指定的呢？\"}},[t._v(\"#\")]),t._v(\" 多个过滤器之间的调用顺序是怎么指定的呢？\")]),t._v(\" \"),s(\"p\",[t._v(\"过滤器的调用顺序遵循\"),s(\"code\",[t._v(\"url\")]),t._v(\"匹配优先级高于\"),s(\"code\",[t._v(\"servlet\")]),t._v(\"名称匹配的规则，多个相同匹配规则之间则依据\"),s(\"code\",[t._v(\"web.xml\")]),t._v(\"中配置的顺序来调用\")]),t._v(\" \"),s(\"p\",[t._v(\"下面引用\"),s(\"a\",{attrs:{href:\"https://www.cnblogs.com/deepSleeping/p/9609809.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"deepSleeping博客\"),s(\"OutboundLink\")],1),t._v(\"的一个例子，有三个过滤器分别做如下配置\")]),t._v(\" \"),s(\"div\",{staticClass:\"language-java extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-java\"}},[s(\"code\",[s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"servlet\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"mapping\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"servlet\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"name\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"myServlet\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"servlet\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"name\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"url\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"pattern\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"foo\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"url\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"pattern\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"servlet\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"mapping\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"mapping\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"name\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"servletFilter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"name\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"url\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"pattern\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"myServlet\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"url\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"pattern\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"mapping\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"mapping\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"name\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"myFilter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"name\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"url\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"pattern\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"foo\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"*\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"url\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"pattern\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"mapping\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"mapping\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"name\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"anotherFilter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"name\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n  \"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),t._v(\"url\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"pattern\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"foo\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"bar\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"url\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"pattern\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"<\")]),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"/\")]),t._v(\"filter\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\"-\")]),t._v(\"mapping\"),s(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[t._v(\">\")]),t._v(\"\\n\")])])]),s(\"p\",[t._v(\"如果一个普通的请求访问的URL是\"),s(\"code\",[t._v(\"/foo/bar\")]),t._v(\"，那么它将匹配所有这3个过滤器。\\n过滤器链将由3个过滤器组成，依次为\"),s(\"code\",[t._v(\"myFilter\")]),t._v(\"、\"),s(\"code\",[t._v(\"anotherFilter\")]),t._v(\"、\"),s(\"code\",[t._v(\"servletFilter\")]),t._v(\"。\\n\"),s(\"code\",[t._v(\"myFilter\")]),t._v(\"将在\"),s(\"code\",[t._v(\"anotherFilter\")]),t._v(\"之前执行,因为这是它们出现\"),s(\"code\",[t._v(\"web.xml\")]),t._v(\"中的顺序。\"),s(\"code\",[t._v(\"servletFilter\")]),t._v(\"最后执行,因为URL映射总是在Servlet名称映射之前执行。\")])])}),[],!1,null,null,null);r.default=e.exports}}]);","extractedComments":[]}